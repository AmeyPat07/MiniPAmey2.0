<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Track Record - UrbanGrow</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <header>
        <div class="header-left">
            <a href="index.html" class="nav-button">üè† Home</a>
            <div class="logo">üåø UrbanGrow</div>
        </div>
        <div class="header-center">
            <input type="text" id="search-bar" placeholder="Search for plants..." />
            <button id="camera-btn" class="nav-button">üì∑</button>
        </div>
        <div class="header-right" id="header-right">
            <!-- Dynamic: Dashboard and Account -->
        </div>
    </header>
    <main>
        <section id="track-record">
            <div class="track-record-header">
                <h1>üåø Your Gardening Track Record</h1>
                <p>History of all your completed gardening tasks</p>
            </div>
            
            <div class="track-record-stats">
                <div class="stat-box">
                    <div class="stat-number" id="total-completed">0</div>
                    <div class="stat-label">Total Tasks Completed</div>
                </div>
                <div class="stat-box">
                    <div class="stat-number" id="this-week">0</div>
                    <div class="stat-label">This Week</div>
                </div>
                <div class="stat-box">
                    <div class="stat-number" id="this-month">0</div>
                    <div class="stat-label">This Month</div>
                </div>
            </div>
            
            <div id="activity-list" class="activity-timeline"></div>
        </section>
    </main>
    <script>
        // Auth check
        const currentUser = JSON.parse(localStorage.getItem('currentUser'));
        if (!currentUser) {
            window.location.href = 'login.html';
        } else {
            // Update header for logged in
            const headerRight = document.getElementById('header-right');
            headerRight.innerHTML = `<a href="dashboard.html" class="nav-button">Dashboard</a> <div class="account-dropdown" id="account-name">${currentUser.name} ‚ñº</div><div class="dropdown-menu" id="dropdown-menu" style="display:none; position:absolute; background:white; border:1px solid #ccc; padding:10px; z-index:1000;"><button onclick="logout()">Log Out</button><button onclick="profile()">Profile</button><button onclick="switchUser()">Switch User</button></div>`;
            // Add event listener for dropdown
            document.getElementById('account-name').addEventListener('click', function() {
                const menu = document.getElementById('dropdown-menu');
                menu.style.display = menu.style.display === 'none' ? 'block' : 'none';
            });
        }

        function logout() {
            localStorage.removeItem('currentUser');
            window.location.href = 'login.html';
        }

        function profile() {
            window.location.href = 'profile.html';
        }

        function switchUser() {
            logout();
        }
    </script>
    <script src="script.js"></script>
    <script>
        // Load task history
        function loadTaskHistory() {
            const taskHistory = JSON.parse(localStorage.getItem('taskHistory')) || [];
            const activityList = document.getElementById('activity-list');
            const totalCompletedEl = document.getElementById('total-completed');
            const thisWeekEl = document.getElementById('this-week');
            const thisMonthEl = document.getElementById('this-month');
            
            // Calculate stats
            const now = new Date();
            const weekAgo = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);
            const monthAgo = new Date(now.getTime() - 30 * 24 * 60 * 60 * 1000);
            
            const thisWeekTasks = taskHistory.filter(t => new Date(t.completedAt) >= weekAgo);
            const thisMonthTasks = taskHistory.filter(t => new Date(t.completedAt) >= monthAgo);
            
            totalCompletedEl.textContent = taskHistory.length;
            thisWeekEl.textContent = thisWeekTasks.length;
            thisMonthEl.textContent = thisMonthTasks.length;
            
            // Display history
            activityList.innerHTML = '';
            
            if (taskHistory.length === 0) {
                activityList.innerHTML = `
                    <div style="text-align: center; padding: 60px 20px; color: #999;">
                        <div style="font-size: 60px; margin-bottom: 20px;">üìã</div>
                        <h3>No completed tasks yet</h3>
                        <p>Complete your first task to see it here!</p>
                        <a href="index.html" style="color: #4CAF50; text-decoration: none; font-weight: 600;">Set a reminder ‚Üí</a>
                    </div>
                `;
                return;
            }
            
            // Group by date
            const groupedByDate = {};
            taskHistory.forEach(task => {
                const date = new Date(task.completedAt).toLocaleDateString();
                if (!groupedByDate[date]) {
                    groupedByDate[date] = [];
                }
                groupedByDate[date].push(task);
            });
            
            // Display grouped tasks
            Object.keys(groupedByDate).forEach(date => {
                const dateHeader = document.createElement('div');
                dateHeader.className = 'date-header';
                dateHeader.innerHTML = `<h3>${date}</h3>`;
                activityList.appendChild(dateHeader);
                
                groupedByDate[date].forEach(task => {
                    const taskIcon = getTaskIcon(task.task);
                    const taskItem = document.createElement('div');
                    taskItem.className = 'history-item';
                    taskItem.innerHTML = `
                        <div class="history-icon">${taskIcon}</div>
                        <div class="history-details">
                            <h4>${task.task} ${task.plantName}</h4>
                            <p>Completed at ${new Date(task.completedAt).toLocaleTimeString()}</p>
                        </div>
                        <div class="history-check">‚úì</div>
                    `;
                    activityList.appendChild(taskItem);
                });
            });
        }
        
        function getTaskIcon(taskType) {
            const icons = {
                'Water': 'üíß',
                'Fertilize': 'üåø',
                'Pesticide': 'üêõ',
                'Cutting': '‚úÇÔ∏è',
                'default': 'üìã'
            };
            return icons[taskType] || icons['default'];
        }
        
        // Load on page load
        if (currentUser) {
            loadTaskHistory();
        }
    </script>
</body>
</html>
