 <!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>UrbanGrow - Smart Assistant for Urban Gardeners</title>
  <link rel="stylesheet" href="style.css" onerror="console.error('❌ style.css not found')" />
  <link rel="icon" href="favicon.ico" type="image/x-icon">
</head>
<body>
  <header>
    <div class="header-left">
      <button id="home-btn" class="nav-button">🏠 Home</button>
      <div class="logo">🌿 UrbanGrow</div>
    </div>
    <div class="header-center">
      <div class="search-container">
        <input type="text" id="search-bar" placeholder="Search for plants..." autocomplete="off" />
        <span class="search-icon">🔍</span>
        <div id="search-suggestions" class="search-suggestions"></div>
      </div>
      <button id="camera-btn" class="nav-button camera-btn">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"></path>
          <circle cx="12" cy="13" r="4"></circle>
        </svg>
      </button>
    </div>
    <div class="header-right" id="header-right">
      <!-- Dynamic: Login/SignUp or Dashboard -->
    </div>
  </header>

  <main>
    <section id="welcome">
      <h1>Welcome to Your Urban Garden</h1>
      <p>Your smart assistant for plant care and gardening success</p>
    </section>

    <section id="features">
      <div class="feature">
        <a href="#" class="feature-link" id="add-plant-btn">
          <span class="icon">➕</span>
          <h2>Add a Plant</h2>
        </a>
        <p>Add a plant present in your garden</p>
      </div>
      <div class="feature">
        <a href="#" class="feature-link" id="identify-plant-btn">
          <span class="icon">📷</span>
          <h2>Identify Plant</h2>
        </a>
        <p>Take a photo to identify your plant</p>
      </div>
      <div class="feature">
        <a href="my-garden.html" class="feature-link">
          <span class="icon">🌱</span>
          <h2>My Garden</h2>
        </a>
        <p>View and manage your plants</p>
      </div>
      <div class="feature">
        <a href="reminders.html" class="feature-link">
          <span class="icon">🔔</span>
          <h2>Set Reminders</h2>
        </a>
        <p>Schedule plant care tasks</p>
      </div>
      <div class="feature">
        <a href="plants.html" class="feature-link">
          <span class="icon">🌱</span>
          <h2>Growing Guides</h2>
        </a>
        <p>Watch tutorials on growing plants</p>
      </div>
      <div class="feature">
        <a href="#" class="feature-link" id="ai-assistant-btn">
          <span class="icon">💬</span>
          <h2>AI Assistant</h2>
        </a>
        <p>Ask gardening questions</p>
      </div>
    </section>

    <!-- 🌿 Reminder Feature Starts Here -->
    <section id="reminder-feature" class="reminder-section">
      <div class="reminder-header">
        <div class="reminder-icon">🔔</div>
        <h2>Set a Plant Reminder</h2>
        <p>Never miss a watering or care task again</p>
      </div>
      
      <div class="reminder-form">
        <div class="form-row">
          <div class="form-group">
            <label for="plantName">
              <span class="label-icon">🌱</span>
              Plant Name
            </label>
            <input type="text" id="plantName" placeholder="e.g. Basil" class="reminder-input" />
          </div>

          <div class="form-group">
            <label for="task">
              <span class="label-icon">📋</span>
              Task Type
            </label>
            <select id="task" class="reminder-select">
              <option value="Water">💧 Water</option>
              <option value="Fertilize">🌿 Fertilize</option>
              <option value="Pesticide">🐛 Pesticide</option>
              <option value="Cutting">✂️ Cutting</option>
            </select>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="frequency">
              <span class="label-icon">🔄</span>
              Frequency
            </label>
            <select id="frequency" class="reminder-select">
              <option value="Once">Once</option>
              <option value="Weekly">Weekly</option>
              <option value="Monthly">Monthly</option>
            </select>
          </div>

          <div class="form-group">
            <label for="reminderTime">
              <span class="label-icon">⏰</span>
              Time
            </label>
            <input type="time" id="reminderTime" class="reminder-input" />
          </div>
        </div>

        <button onclick="setReminder()" class="reminder-button">
          <span>🔔</span>
          Set Reminder
        </button>
      </div>
      
      <audio id="alarmSound" src="alarm.mp3" preload="auto" onerror="console.error('❌ alarm.mp3 not found')"></audio>
    </section>
    <!-- 🌿 Reminder Feature Ends Here -->

    <section id="info-cards">
      <div class="info-card">
        <h3>Recent Identifications</h3>
        <div id="recent-identifications-list">
          <!-- Recent identifications will be loaded here dynamically -->
          <div class="info-item" style="color: #999; font-style: italic;">
            No recent identifications yet. Use "Identify Plant" to capture images!
          </div>
        </div>
      </div>
      <div class="info-card">
        <h3>Today's Tasks</h3>
        <div id="today-tasks-list">
          <!-- Today's tasks will be loaded dynamically -->
        </div>
      </div>
      <div class="info-card">
        <h3>Plant Health</h3>
        <div class="health-stats">
          <div><strong>0</strong><br />Healthy</div>
          <div><strong>0</strong><br />Needs Attention</div>
        </div>
      </div>
    </section>
  </main>

  <!-- Camera Modal -->
  <div id="camera-modal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.9); z-index:9999; justify-content:center; align-items:center;">
    <div style="position:relative; max-width:90%; max-height:90%; display:flex; flex-direction:column; align-items:center;">
      <button id="close-camera" style="position:absolute; top:10px; right:10px; background:#ff4444; color:white; border:none; padding:10px 20px; border-radius:5px; cursor:pointer; font-size:16px; z-index:10000;">✕ Close</button>
      <video id="camera-video" autoplay playsinline style="width:100%; max-width:640px; border-radius:10px; margin-top:50px;"></video>
      <canvas id="camera-canvas" style="display:none;"></canvas>
      <button id="capture-photo" style="margin-top:20px; background:#4CAF50; color:white; border:none; padding:15px 30px; border-radius:5px; cursor:pointer; font-size:18px;">📸 Capture Photo</button>
      <img id="captured-image" style="display:none; max-width:640px; border-radius:10px; margin-top:20px;" />
      <div id="photo-actions" style="display:none; margin-top:20px;">
        <button id="retake-photo" style="background:#ff9800; color:white; border:none; padding:10px 20px; border-radius:5px; cursor:pointer; font-size:16px; margin-right:10px;">🔄 Retake</button>
        <button id="use-photo" style="background:#2196F3; color:white; border:none; padding:10px 20px; border-radius:5px; cursor:pointer; font-size:16px;">✓ Use Photo</button>
      </div>
    </div>
  </div>

  <!-- Hidden file upload input -->
  <input type="file" id="file-upload-input" accept="image/*" capture="environment" style="display:none;" />
  
  <!-- Add Plant Modal -->
  <div id="add-plant-modal" class="plant-modal">
    <div class="plant-modal-content">
      <div class="modal-header">
        <h2>🌿 Add a Plant to Your Garden</h2>
        <button class="close-modal" id="close-plant-modal">&times;</button>
      </div>
      
      <div class="modal-body">
        <!-- Search and Filter Section -->
        <div class="modal-search-section">
          <input type="text" id="plant-search" placeholder="🔍 Search plants by name..." class="modal-search-input">
          <select id="plant-category-filter" class="modal-filter-select">
            <option value="all">All Categories</option>
            <option value="Vegetable">Vegetables</option>
            <option value="Herb">Herbs</option>
            <option value="Fruit">Fruits</option>
            <option value="Indoor Plant">Indoor Plants</option>
            <option value="Succulent">Succulents</option>
          </select>
        </div>

        <!-- Plants Grid -->
        <div id="plants-grid" class="plants-grid">
          <!-- Plants will be dynamically loaded here -->
        </div>
      </div>
    </div>
  </div>
                               

  <script>
    // Auth check
    const currentUser = JSON.parse(localStorage.getItem('currentUser'));
    if (!currentUser) {
      window.location.href = 'login.html';
    } else {
      // Update header for logged in
      const headerRight = document.getElementById('header-right');
      headerRight.innerHTML = `
        <a href="dashboard.html" class="nav-button">Dashboard</a> 
        <div class="account-dropdown" id="account-name">
          <span class="user-icon">👤</span>
          <span class="user-name">${currentUser.name}</span>
          <span class="dropdown-arrow">▼</span>
        </div>
        <div class="dropdown-menu" id="dropdown-menu">
          <div class="dropdown-header">
            <div class="dropdown-user-icon">👤</div>
            <div class="dropdown-user-info">
              <div class="dropdown-user-name">${currentUser.name}</div>
              <div class="dropdown-user-email">${currentUser.email || 'Urban Gardener'}</div>
            </div>
          </div>
          <div class="dropdown-divider"></div>
          <button class="dropdown-item" onclick="profile()">
            <span class="dropdown-item-icon">👤</span>
            <span>Profile</span>
          </button>
          <button class="dropdown-item" onclick="switchUser()">
            <span class="dropdown-item-icon">🔄</span>
            <span>Switch User</span>
          </button>
          <div class="dropdown-divider"></div>
          <button class="dropdown-item logout" onclick="logout()">
            <span class="dropdown-item-icon">🚪</span>
            <span>Log Out</span>
          </button>
        </div>
      `;
      // Add event listener for dropdown
      document.getElementById('account-name').addEventListener('click', function(e) {
        e.stopPropagation();
        const menu = document.getElementById('dropdown-menu');
        menu.style.display = menu.style.display === 'none' ? 'block' : 'none';
      });
      
      // Close dropdown when clicking outside
      document.addEventListener('click', function(e) {
        const menu = document.getElementById('dropdown-menu');
        const accountDropdown = document.getElementById('account-name');
        if (menu && accountDropdown && !accountDropdown.contains(e.target) && !menu.contains(e.target)) {
          menu.style.display = 'none';
        }
      });
    }

    function logout() {
      localStorage.removeItem('currentUser');
      window.location.href = 'login.html';
    }

    function profile() {
      window.location.href = 'profile.html';
    }

    function switchUser() {
      logout();
    }

    // Show reminder notification modal
    function showReminderNotification(task, plant, reminderId) {
      const modal = document.createElement('div');
      modal.id = 'reminder-notification-modal';
      modal.style.cssText = `
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.8);
        z-index: 10001;
        display: flex;
        justify-content: center;
        align-items: center;
        animation: fadeIn 0.3s ease;
      `;
      
      modal.innerHTML = `
        <div style="background: linear-gradient(135deg, #7ed56f, #28b485); padding: 40px; border-radius: 20px; text-align: center; box-shadow: 0 20px 60px rgba(0,0,0,0.5); animation: bounce 0.5s ease; max-width: 400px;">
          <div style="font-size: 80px; margin-bottom: 20px; animation: ring 1s ease infinite;">🔔</div>
          <h2 style="color: white; font-size: 28px; margin-bottom: 15px; font-weight: 700;">Reminder Alert!</h2>
          <p style="color: white; font-size: 20px; margin-bottom: 30px;">Time to <strong>${task}</strong> your <strong>${plant}</strong>!</p>
          <button onclick="completeReminder(${reminderId})" style="background: white; color: #28b485; border: none; padding: 15px 40px; border-radius: 30px; font-size: 18px; font-weight: 700; cursor: pointer; box-shadow: 0 4px 15px rgba(0,0,0,0.2);">
            Mark as Complete ✓
          </button>
        </div>
      `;
      
      // Add ring animation
      const style = document.createElement('style');
      style.textContent = `
        @keyframes ring {
          0%, 100% { transform: rotate(0deg); }
          10%, 30% { transform: rotate(-10deg); }
          20%, 40% { transform: rotate(10deg); }
        }
      `;
      document.head.appendChild(style);
      
      document.body.appendChild(modal);
      
      // Also try browser notification if permitted
      if ("Notification" in window && Notification.permission === "granted") {
        new Notification("UrbanGrow Reminder", {
          body: `Time to ${task} your ${plant}!`,
          icon: "🔔"
        });
      }
    }

    // Complete reminder and save to history
    function completeReminder(reminderId) {
      let reminders = JSON.parse(localStorage.getItem('reminders')) || [];
      const reminderIndex = reminders.findIndex(r => r.id === reminderId);
      
      if (reminderIndex !== -1) {
        reminders[reminderIndex].status = 'completed';
        reminders[reminderIndex].completedAt = new Date().toISOString();
        localStorage.setItem('reminders', JSON.stringify(reminders));
        
        // Add to task history
        let taskHistory = JSON.parse(localStorage.getItem('taskHistory')) || [];
        taskHistory.unshift({
          ...reminders[reminderIndex],
          completedAt: new Date().toISOString()
        });
        localStorage.setItem('taskHistory', JSON.stringify(taskHistory));
      }
      
      // Remove modal
      const modal = document.getElementById('reminder-notification-modal');
      if (modal) modal.remove();
    }

    function setReminder() {
      const plant = document.getElementById('plantName').value;
      const task = document.getElementById('task').value;
      const frequency = document.getElementById('frequency').value;
      const time = document.getElementById('reminderTime').value;

      if (!plant || !time) {
        alert("Please enter plant name and time.");
        return;
      }

      // Request notification permission
      if ("Notification" in window && Notification.permission === "default") {
        Notification.requestPermission();
      }

      const now = new Date();
      const [hours, minutes] = time.split(":");
      const reminderTime = new Date();
      reminderTime.setHours(hours, minutes, 0, 0);

      let delay = reminderTime - now;
      if (delay < 0) delay += 86400000; // next day

      // Save reminder to localStorage
      const reminder = {
        id: Date.now(),
        plantName: plant,
        task: task,
        frequency: frequency,
        time: time,
        date: reminderTime.toISOString(),
        status: 'pending',
        createdAt: new Date().toISOString()
      };

      let reminders = JSON.parse(localStorage.getItem('reminders')) || [];
      reminders.push(reminder);
      localStorage.setItem('reminders', JSON.stringify(reminders));

      alert(`Reminder set for ${task} ${plant} (${frequency}) at ${time}`);

      setTimeout(() => {
        // Play alarm sound immediately
        const alarmSound = document.getElementById('alarmSound');
        alarmSound.play().catch(err => console.log('Audio play failed:', err));
        
        // Show custom notification modal instead of alert
        showReminderNotification(task, plant, reminder.id);
      }, delay);
    }

    // Camera functionality
    let cameraStream = null;
    const cameraModal = document.getElementById('camera-modal');
    const cameraVideo = document.getElementById('camera-video');
    const cameraCanvas = document.getElementById('camera-canvas');
    const capturedImage = document.getElementById('captured-image');
    const captureBtn = document.getElementById('capture-photo');
    const retakeBtn = document.getElementById('retake-photo');
    const usePhotoBtn = document.getElementById('use-photo');
    const closeBtn = document.getElementById('close-camera');
    const photoActions = document.getElementById('photo-actions');

    // Open camera function
    async function openCamera() {
      try {
        // Check if mediaDevices is supported
        if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
          throw new Error('Camera API not supported in this browser');
        }

        cameraStream = await navigator.mediaDevices.getUserMedia({ 
          video: { facingMode: 'environment' }, // Use back camera on mobile
          audio: false 
        });
        cameraVideo.srcObject = cameraStream;
        cameraModal.style.display = 'flex';
        cameraVideo.style.display = 'block';
        captureBtn.style.display = 'block';
        capturedImage.style.display = 'none';
        photoActions.style.display = 'none';
      } catch (error) {
        console.error('Error accessing camera:', error);
        let errorMessage = 'Unable to access camera.\n\n';
        
        if (error.name === 'NotAllowedError' || error.name === 'PermissionDeniedError') {
          errorMessage += '📷 Camera access is BLOCKED.\n\n';
          errorMessage += 'To fix this:\n';
          errorMessage += '1. Click the 🔒 or ⓘ icon in the address bar\n';
          errorMessage += '2. Find "Camera" and change to "Allow"\n';
          errorMessage += '3. Refresh the page (F5)\n';
          errorMessage += '4. Try again\n\n';
          errorMessage += 'Or use "Upload Photo" option instead.';
        } else if (error.name === 'NotFoundError') {
          errorMessage += 'No camera found on this device.';
        } else if (error.name === 'NotReadableError') {
          errorMessage += 'Camera is already in use by another application.';
        } else {
          errorMessage += error.message || 'Unknown error occurred.';
        }
        
        alert(errorMessage);
        
        // Offer file upload as alternative
        if (confirm('Would you like to upload a photo from your device instead?')) {
          document.getElementById('file-upload-input').click();
        }
      }
    }

    // Close camera function
    function closeCamera() {
      if (cameraStream) {
        cameraStream.getTracks().forEach(track => track.stop());
        cameraStream = null;
      }
      cameraModal.style.display = 'none';
      cameraVideo.style.display = 'block';
      captureBtn.style.display = 'block';
      capturedImage.style.display = 'none';
      photoActions.style.display = 'none';
    }

    // Capture photo function
    function capturePhoto() {
      const context = cameraCanvas.getContext('2d');
      cameraCanvas.width = cameraVideo.videoWidth;
      cameraCanvas.height = cameraVideo.videoHeight;
      context.drawImage(cameraVideo, 0, 0);
      
      const imageDataUrl = cameraCanvas.toDataURL('image/png');
      capturedImage.src = imageDataUrl;
      
      // Hide video and capture button, show image and actions
      cameraVideo.style.display = 'none';
      captureBtn.style.display = 'none';
      capturedImage.style.display = 'block';
      photoActions.style.display = 'block';
    }

    // Retake photo function
    function retakePhoto() {
      cameraVideo.style.display = 'block';
      captureBtn.style.display = 'block';
      capturedImage.style.display = 'none';
      photoActions.style.display = 'none';
    }

    // Use photo function
    function usePhoto() {
      const imageDataUrl = capturedImage.src;
      
      // Get existing identifications or create new array
      let recentIdentifications = JSON.parse(localStorage.getItem('recentIdentifications')) || [];
      
      // Create new identification entry
      const identification = {
        id: Date.now(),
        image: imageDataUrl,
        plantName: 'Unknown Plant', // Can be updated later with actual identification
        timestamp: new Date().toISOString(),
        dateString: new Date().toLocaleDateString()
      };
      
      // Add to beginning of array (most recent first)
      recentIdentifications.unshift(identification);
      
      // Keep only last 10 identifications
      if (recentIdentifications.length > 10) {
        recentIdentifications = recentIdentifications.slice(0, 10);
      }
      
      // Save to localStorage
      localStorage.setItem('recentIdentifications', JSON.stringify(recentIdentifications));
      localStorage.setItem('plantImage', imageDataUrl);
      
      alert('Photo captured! You can now use this for plant identification.');
      closeCamera();
      
      // Refresh the recent identifications display
      loadRecentIdentifications();
      
      // You can redirect to identification page or process the image here
      // window.location.href = 'identify.html';
    }

    // Event listeners for camera buttons
    document.getElementById('camera-btn').addEventListener('click', (e) => {
      e.preventDefault();
      openCamera();
    });

    document.getElementById('identify-plant-btn').addEventListener('click', (e) => {
      e.preventDefault();
      openCamera();
    });

    closeBtn.addEventListener('click', closeCamera);
    captureBtn.addEventListener('click', capturePhoto);
    retakeBtn.addEventListener('click', retakePhoto);
    usePhotoBtn.addEventListener('click', usePhoto);

    // File upload handler
    document.getElementById('file-upload-input').addEventListener('change', function(e) {
      const file = e.target.files[0];
      if (file && file.type.startsWith('image/')) {
        const reader = new FileReader();
        reader.onload = function(event) {
          const imageDataUrl = event.target.result;
          
          // Get existing identifications or create new array
          let recentIdentifications = JSON.parse(localStorage.getItem('recentIdentifications')) || [];
          
          // Create new identification entry
          const identification = {
            id: Date.now(),
            image: imageDataUrl,
            plantName: 'Unknown Plant',
            timestamp: new Date().toISOString(),
            dateString: new Date().toLocaleDateString()
          };
          
          // Add to beginning of array (most recent first)
          recentIdentifications.unshift(identification);
          
          // Keep only last 10 identifications
          if (recentIdentifications.length > 10) {
            recentIdentifications = recentIdentifications.slice(0, 10);
          }
          
          // Save to localStorage
          localStorage.setItem('recentIdentifications', JSON.stringify(recentIdentifications));
          localStorage.setItem('plantImage', imageDataUrl);
          
          alert('Photo uploaded successfully! You can now use this for plant identification.');
          
          // Refresh the recent identifications display
          loadRecentIdentifications();
          
          // You can redirect to identification page or process the image here
          // window.location.href = 'identify.html';
        };
        reader.readAsDataURL(file);
      } else {
        alert('Please select a valid image file.');
      }
    });

    // Function to load and display recent identifications
    function loadRecentIdentifications() {
      const recentIdentifications = JSON.parse(localStorage.getItem('recentIdentifications')) || [];
      const listContainer = document.getElementById('recent-identifications-list');
      
      if (!listContainer) return;
      
      // Clear existing content
      listContainer.innerHTML = '';
      
      if (recentIdentifications.length === 0) {
        listContainer.innerHTML = `
          <div class="info-item" style="color: #999; font-style: italic;">
            No recent identifications yet. Use "Identify Plant" to capture images!
          </div>
        `;
        return;
      }
      
      // Display up to 3 most recent identifications
      const displayCount = Math.min(3, recentIdentifications.length);
      
      for (let i = 0; i < displayCount; i++) {
        const item = recentIdentifications[i];
        const timeDiff = getTimeDifference(item.timestamp);
        
        const itemDiv = document.createElement('div');
        itemDiv.className = 'info-item';
        itemDiv.style.cursor = 'pointer';
        itemDiv.innerHTML = `
          <img src="${item.image}" alt="${item.plantName}" width="50" height="50" style="object-fit: cover; border-radius: 5px;">
          <div>
            <strong>${item.plantName}</strong><br />
            Identified ${timeDiff}
          </div>
        `;
        
        // Add click handler to view full image
        itemDiv.addEventListener('click', () => {
          showFullImage(item);
        });
        
        listContainer.appendChild(itemDiv);
      }
    }

    // Function to calculate time difference
    function getTimeDifference(timestamp) {
      const now = new Date();
      const past = new Date(timestamp);
      const diffMs = now - past;
      const diffMins = Math.floor(diffMs / 60000);
      const diffHours = Math.floor(diffMs / 3600000);
      const diffDays = Math.floor(diffMs / 86400000);
      
      if (diffMins < 1) return 'just now';
      if (diffMins < 60) return `${diffMins} minute${diffMins > 1 ? 's' : ''} ago`;
      if (diffHours < 24) return `${diffHours} hour${diffHours > 1 ? 's' : ''} ago`;
      if (diffDays === 1) return 'yesterday';
      if (diffDays < 7) return `${diffDays} days ago`;
      return past.toLocaleDateString();
    }

    // Function to show full image in modal
    function showFullImage(item) {
      const modal = document.createElement('div');
      modal.style.cssText = `
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0,0,0,0.9);
        z-index: 10000;
        display: flex;
        justify-content: center;
        align-items: center;
        flex-direction: column;
      `;
      
      modal.innerHTML = `
        <div style="position: relative; max-width: 90%; max-height: 90%; text-align: center;">
          <button onclick="this.parentElement.parentElement.remove()" style="position: absolute; top: -40px; right: 0; background: #ff4444; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; font-size: 16px;">✕ Close</button>
          <img src="${item.image}" style="max-width: 100%; max-height: 80vh; border-radius: 10px; box-shadow: 0 4px 20px rgba(0,0,0,0.5);">
          <div style="color: white; margin-top: 20px; font-size: 18px;">
            <strong>${item.plantName}</strong><br>
            <span style="font-size: 14px; color: #ccc;">Captured on ${new Date(item.timestamp).toLocaleString()}</span>
          </div>
        </div>
      `;
      
      modal.addEventListener('click', (e) => {
        if (e.target === modal) {
          modal.remove();
        }
      });
      
      document.body.appendChild(modal);
    }

    // Function to load and display today's tasks
    function loadTodayTasks() {
      const reminders = JSON.parse(localStorage.getItem('reminders')) || [];
      const tasksContainer = document.getElementById('today-tasks-list');
      
      if (!tasksContainer) return;
      
      // Get today's date
      const today = new Date();
      today.setHours(0, 0, 0, 0);
      
      // Filter tasks for today
      const todaysTasks = reminders.filter(reminder => {
        const reminderDate = new Date(reminder.date || reminder.time);
        reminderDate.setHours(0, 0, 0, 0);
        return reminderDate.getTime() === today.getTime();
      });
      
      // Clear existing content
      tasksContainer.innerHTML = '';
      
      if (todaysTasks.length === 0) {
        tasksContainer.innerHTML = `
          <div class="info-item" style="color: #999; font-style: italic;">
            No tasks scheduled for today
          </div>
        `;
        return;
      }
      
      // Display up to 3 most recent tasks
      const displayCount = Math.min(3, todaysTasks.length);
      
      for (let i = 0; i < displayCount; i++) {
        const task = todaysTasks[i];
        const taskIcon = getTaskIconForHome(task.task || task.type);
        
        const taskDiv = document.createElement('div');
        taskDiv.className = 'info-item';
        taskDiv.innerHTML = `
          <div style="font-size: 32px;">${taskIcon}</div>
          <div>
            <strong>${task.task || task.type} ${task.plantName || task.plant || ''}</strong><br />
            Due ${task.time || 'today'}
          </div>
        `;
        
        tasksContainer.appendChild(taskDiv);
      }
    }
    
    // Get appropriate icon for task type
    function getTaskIconForHome(taskType) {
      const icons = {
        'Water': '💧',
        'Fertilize': '🌿',
        'Pesticide': '🐛',
        'Cutting': '✂️',
        'Prune': '✂️',
        'default': '📋'
      };
      return icons[taskType] || icons['default'];
    }

    // Load recent identifications and today's tasks on page load
    window.addEventListener('DOMContentLoaded', () => {
      loadRecentIdentifications();
      loadTodayTasks();
    });

    // === Search Functionality with Autocomplete ===
    let plantsDatabase = [];
    const searchBar = document.getElementById('search-bar');
    const suggestionsContainer = document.getElementById('search-suggestions');
    
    console.log('🔍 Search functionality initializing on index.html...');
    
    // Load plants database
    async function loadPlantsDatabase() {
      try {
        const response = await fetch('plants-database.json');
        const data = await response.json();
        plantsDatabase = data.plants || [];
        console.log('✅ Plants database loaded:', plantsDatabase.length, 'plants');
      } catch (error) {
        console.error('❌ Error loading plants database:', error);
      }
    }
    
    // Search plants function
    function searchPlants(query) {
      if (!query || query.trim().length === 0) {
        return [];
      }
      
      const searchTerm = query.toLowerCase().trim();
      
      return plantsDatabase.filter(plant => {
        return plant.name.toLowerCase().includes(searchTerm) ||
               plant.scientificName.toLowerCase().includes(searchTerm) ||
               plant.category.toLowerCase().includes(searchTerm);
      }).slice(0, 8);
    }
    
    // Display search suggestions
    function displaySuggestions(results) {
      if (!suggestionsContainer) return;
      
      suggestionsContainer.innerHTML = '';
      
      if (results.length === 0) {
        suggestionsContainer.innerHTML = '<div class="no-results">No plants found. Try a different search term.</div>';
        suggestionsContainer.classList.add('active');
        return;
      }
      
      results.forEach(plant => {
        const suggestionItem = document.createElement('div');
        suggestionItem.className = 'suggestion-item';
        suggestionItem.innerHTML = `
          <span class="suggestion-icon">🌿</span>
          <div class="suggestion-text">
            <div class="suggestion-name">${plant.name}</div>
            <div class="suggestion-category">${plant.category} • ${plant.scientificName}</div>
          </div>
        `;
        
        suggestionItem.addEventListener('click', () => {
          showPlantDetail(plant);
          suggestionsContainer.classList.remove('active');
          searchBar.value = '';
        });
        
        suggestionsContainer.appendChild(suggestionItem);
      });
      
      suggestionsContainer.classList.add('active');
    }
    
    // Hide suggestions
    function hideSuggestions() {
      if (suggestionsContainer) {
        setTimeout(() => {
          suggestionsContainer.classList.remove('active');
        }, 200);
      }
    }
    
    // Show plant detail in modal
    function showPlantDetail(plant) {
      const modal = document.getElementById('plant-detail-modal');
      const plantName = document.getElementById('detail-plant-name');
      const scientificName = document.getElementById('detail-scientific-name');
      const plantBody = document.getElementById('plant-detail-body');
      
      if (!modal || !plantName || !scientificName || !plantBody) return;
      
      plantName.textContent = plant.name;
      scientificName.textContent = plant.scientificName;
      
      let difficultyClass = 'badge-easy';
      if (plant.difficulty.toLowerCase().includes('moderate')) {
        difficultyClass = 'badge-moderate';
      } else if (plant.difficulty.toLowerCase().includes('hard')) {
        difficultyClass = 'badge-hard';
      }
      
      plantBody.innerHTML = `
        <div class="plant-detail-section">
          <h3>📊 Quick Info</h3>
          <div style="margin-bottom: 15px;">
            <span class="plant-detail-badge ${difficultyClass}">${plant.difficulty}</span>
            <span class="plant-detail-badge" style="background: #e3f2fd; color: #1565c0;">${plant.category}</span>
          </div>
        </div>
        
        <div class="plant-detail-section">
          <h3>💧 Care Requirements</h3>
          <div class="plant-detail-grid">
            <div class="plant-detail-item">
              <div class="plant-detail-label">💧 Watering</div>
              <div class="plant-detail-value">${plant.wateringFrequency}</div>
            </div>
            <div class="plant-detail-item">
              <div class="plant-detail-label">☀️ Sunlight</div>
              <div class="plant-detail-value">${plant.sunlight}</div>
            </div>
            <div class="plant-detail-item">
              <div class="plant-detail-label">🌱 Soil Type</div>
              <div class="plant-detail-value">${plant.soilType}</div>
            </div>
            <div class="plant-detail-item">
              <div class="plant-detail-label">📏 Spacing</div>
              <div class="plant-detail-value">${plant.spacing}</div>
            </div>
          </div>
        </div>
        
        <div class="plant-detail-section">
          <h3>⏱️ Growth Information</h3>
          <div class="plant-detail-item">
            <div class="plant-detail-label">🕐 Growth Time</div>
            <div class="plant-detail-value">${plant.growthTime}</div>
          </div>
        </div>
        
        <div class="plant-detail-section" style="text-align: center; margin-top: 30px;">
          <button onclick="addPlantToGarden('${plant.name}')" class="nav-button" style="margin-right: 10px;">
            ➕ Add to My Garden
          </button>
          <button onclick="setReminderForPlant('${plant.name}')" class="nav-button" style="background: linear-gradient(45deg, #f093fb, #f5576c);">
            🔔 Set Reminder
          </button>
        </div>
      `;
      
      modal.classList.add('active');
      document.body.style.overflow = 'hidden';
    }
    
    // Close plant detail modal
    function closePlantDetail() {
      const modal = document.getElementById('plant-detail-modal');
      if (modal) {
        modal.classList.remove('active');
        document.body.style.overflow = '';
      }
    }
    
    // Add plant to garden
    function addPlantToGarden(plantName) {
      let garden = JSON.parse(localStorage.getItem('garden')) || [];
      
      const exists = garden.some(p => p.name === plantName);
      if (exists) {
        alert(`"${plantName}" is already in your garden!`);
        return;
      }
      
      garden.push({ 
        name: plantName, 
        addedAt: new Date().toISOString() 
      });
      localStorage.setItem('garden', JSON.stringify(garden));
      alert(`✅ "${plantName}" added to your garden!`);
    }
    
    // Set reminder for plant
    function setReminderForPlant(plantName) {
      localStorage.setItem('reminderPlantName', plantName);
      alert(`Setting reminder for "${plantName}". Redirecting to reminders page...`);
      window.location.href = 'reminders.html';
    }
    
    // Search bar event listeners
    if (searchBar) {
      console.log('✅ Search bar found and attaching listeners...');
      
      searchBar.addEventListener('input', function(e) {
        const query = e.target.value;
        console.log('🔍 Searching for:', query);
        
        if (query.trim().length === 0) {
          hideSuggestions();
          return;
        }
        
        const results = searchPlants(query);
        console.log('📊 Found results:', results.length);
        displaySuggestions(results);
      });
      
      searchBar.addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
          const query = searchBar.value;
          const results = searchPlants(query);
          
          if (results.length > 0) {
            showPlantDetail(results[0]);
            suggestionsContainer.classList.remove('active');
            searchBar.value = '';
          } else {
            alert('No plants found for: ' + query);
          }
          
          e.preventDefault();
        }
      });
      
      searchBar.addEventListener('blur', hideSuggestions);
      
      searchBar.addEventListener('focus', function() {
        if (searchBar.value.trim().length > 0) {
          const results = searchPlants(searchBar.value);
          displaySuggestions(results);
        }
      });
    } else {
      console.error('❌ Search bar not found!');
    }
    
    // Close modal when clicking outside
    document.addEventListener('click', function(e) {
      const modal = document.getElementById('plant-detail-modal');
      if (e.target === modal) {
        closePlantDetail();
      }
    });
    
    // Load plants database
    loadPlantsDatabase();
  </script>
  
  <!-- Plant Detail Modal -->
  <div id="plant-detail-modal" class="plant-detail-modal">
    <div class="plant-detail-content">
      <div class="plant-detail-header">
        <button class="plant-detail-close" onclick="closePlantDetail()">&times;</button>
        <h2 class="plant-detail-name" id="detail-plant-name"></h2>
        <p class="plant-detail-scientific" id="detail-scientific-name"></p>
      </div>
      <div class="plant-detail-body" id="plant-detail-body">
        <!-- Plant details will be loaded here dynamically -->
      </div>
    </div>
  </div>

  <!-- Coming Soon Modal -->
  <div id="coming-soon-modal" class="coming-soon-modal" style="display: none;">
    <div class="coming-soon-content">
      <button class="coming-soon-close" onclick="closeComingSoonModal()">&times;</button>
      <div class="coming-soon-icon">🚀</div>
      <h2>AI Assistant Coming Soon!</h2>
      <p>We're working hard to bring you an intelligent AI assistant that will help answer all your gardening questions.</p>
      <div class="coming-soon-features">
        <div class="feature-item">
          <span class="feature-emoji">🤖</span>
          <span>Smart plant care advice</span>
        </div>
        <div class="feature-item">
          <span class="feature-emoji">💡</span>
          <span>Personalized recommendations</span>
        </div>
        <div class="feature-item">
          <span class="feature-emoji">📚</span>
          <span>Expert gardening tips</span>
        </div>
      </div>
      <p class="coming-soon-footer">Stay tuned for updates! 🌿</p>
      <button class="coming-soon-button" onclick="closeComingSoonModal()">Got it!</button>
    </div>
  </div>

  <!-- Plant Modal Script -->
  <script src="plant-modal.js"></script>
  
  <script>
    // AI Assistant Coming Soon functionality
    document.getElementById('ai-assistant-btn').addEventListener('click', function(e) {
      e.preventDefault();
      document.getElementById('coming-soon-modal').style.display = 'flex';
      document.body.style.overflow = 'hidden';
    });

    function closeComingSoonModal() {
      document.getElementById('coming-soon-modal').style.display = 'none';
      document.body.style.overflow = 'auto';
    }

    // Close modal when clicking outside
    document.getElementById('coming-soon-modal').addEventListener('click', function(e) {
      if (e.target === this) {
        closeComingSoonModal();
      }
    });
  </script>
  
</body>
</html>
